
<!DOCTYPE html>
<html>
<head>
<title>Trying hard</title>
<audio id="rickAudio" loop>
  <source src="https://archive.org/download/NeverGonnaGiveYouUp/jocofullinterview41.mp3" type="audio/mpeg">
</audio>


<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<style>
body {
  font-family: Arial;
  padding: 40px;
  text-align: center;
}

/* Username section */
#userSettings {
  position: fixed;
  top: 10px;
  left: 10px;
  text-align: left;
}

#username {
  height: 35px;
  width: 160px;
}

#nameNote {
  font-size: 12px;
  color: #555;
  margin-top: 3px;
}

#colorBtn {
  height: 35px;
  width: 35px;
  border-radius: 6px;
  border: 2px solid #333;
  cursor: pointer;
  display: inline-block;
  vertical-align: middle;
}

/* Improved color grid */
#colorPalette {
  display: none;
  margin-top: 8px;
  display: grid;
  grid-template-columns: repeat(5, 30px);
  gap: 8px;
  background: white;
  padding: 8px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.colorSquare {
  width: 30px;
  height: 30px;
  border-radius: 6px;
  cursor: pointer;
  transition: transform 0.1s, box-shadow 0.1s;
}

.colorSquare:hover {
  transform: scale(1.1);
  box-shadow: 0 0 5px rgba(0,0,0,0.5);
}

/* Timer */
#timer {
  position: fixed;
  top: 10px;
  right: 10px;
  font-weight: bold;
}

/* Chat */
#comments {
  max-width: 600px;
  margin: auto;
  text-align: left;
}

.comment {
  background: #eee;
  padding: 8px;
  margin: 5px 0;
  border-radius: 6px;
  word-wrap: break-word;
}

button, input {
  padding: 8px;
  margin: 5px;
  font-size: 14px;
}

/* Rickroll */
#rickroll {
  display: none;
  position: fixed;
  inset: 0;
  background: black;
  z-index: 999;
}

#rickroll img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
  /* Dark mode */
.dark {
  background: #121212;
  color: white;
}

.dark .comment {
  background: #1e1e1e;
}

input:checked + .slider {
  background-color: #4cd964;
}

input:checked + .slider:before {
  transform: translateX(22px);
}

</style>
</head>

<body>

<div id="userSettings">
  <input id="username" placeholder="Your name">
  <div id="colorBtn"></div>
  <div id="nameNote">You need to enter your name to write comment</div>
  <div id="colorPalette"></div>
  
</div>

<div id="timer">Syncing...</div>
<div id="onlineCount">Online: 0</div>


<h2>Made by Tryhards</h2>

<input id="msg" placeholder="Write a comment">
<button id="postBtn" onclick="post()">Post</button>
<button onclick="rickroll()">Admin panel</button>

<div id="comments"></div>

<div id="rickroll" onclick="closeRickroll()">
  <img src="https://media.giphy.com/media/Vuw9m5wXviFIQ/giphy.gif">
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

// ---------------- FIREBASE ----------------

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "site-976a4.firebaseapp.com",
  databaseURL: "https://site-976a4-default-rtdb.firebaseio.com",
  projectId: "site-976a4",
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database().ref("comments");
const timerRef = firebase.database().ref("globalTimer");
const onlineRef = firebase.database().ref("onlineUsers");

const TIMER_DURATION = 600;

// ---------------- DOM ----------------

const timer = document.getElementById("timer");
const comments = document.getElementById("comments");
const username = document.getElementById("username");
const msg = document.getElementById("msg");
const postBtn = document.getElementById("postBtn");
const colorBtn = document.getElementById("colorBtn");
const colorPalette = document.getElementById("colorPalette");
const onlineDisplay = document.getElementById("onlineCount");

// ---------------- SETTINGS ----------------

const SPAM_COOLDOWN = 3000;
let lastPostTime = 0;

const bannedWords = ["badword1","badword2","spam"];

function containsBannedWord(text){
  text = text.toLowerCase();
  return bannedWords.some(w => text.includes(w));
}

// ---------------- AUTH ----------------

if (firebase.auth) {
  firebase.auth().signInAnonymously().catch(console.error);
}

// ---------------- ONLINE USERS ----------------

const presence = onlineRef.push(true);
presence.onDisconnect().remove();

onlineRef.on("value", snap => {
  if (onlineDisplay)
    onlineDisplay.innerText = `Online: ${snap.numChildren()}`;
});

// ---------------- TIMER SYNC ----------------

let resetAt = null;
let synced = false;

timerRef.transaction(current => {
  if (current === null)
    return Date.now() + TIMER_DURATION*1000;
  return current;
});

timerRef.on("value", snap => {
  resetAt = snap.val();
  synced = true;
});

setInterval(() => {

  if (!timer) return;

  if (!synced || !resetAt){
    timer.innerText = "Syncing...";
    return;
  }

  let remaining = Math.floor((resetAt - Date.now())/1000);

  if (remaining <= 0){
    timerRef.transaction(current => {
      if (current <= Date.now()){
        db.remove();
        return Date.now() + TIMER_DURATION*1000;
      }
      return current;
    });
    remaining = TIMER_DURATION;
  }

  let m = Math.floor(remaining/60);
  let s = remaining%60;

  timer.innerText =
    `Reset in: ${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;

},1000);

// ---------------- COLORS ----------------

const colors = [
"#ff0000","#00ff00","#0000ff","#ff9900","#ff00ff",
"#00ffff","#800000","#008000","#000080","#808000",
"#800080","#008080","#444444","#999999","#ff4444",
"#44ff44","#4444ff","#ffaa00","#aa00ff","#00ffaa"
];

let selectedColor = colors[0];

if(colorBtn) colorBtn.style.background = selectedColor;

colors.forEach(c=>{
  let sq=document.createElement("div");
  sq.className="colorSquare";
  sq.style.background=c;
  sq.onclick=()=>{
    selectedColor=c;
    if(colorBtn) colorBtn.style.background=c;
    colorPalette.style.display="none";
  };
  if(colorPalette) colorPalette.appendChild(sq);
});

if(colorBtn){
  colorBtn.onclick=()=>{
    colorPalette.style.display=
      colorPalette.style.display==="grid"?"none":"grid";
  };
}

// ---------------- USERNAME CHECK ----------------

if(postBtn && username){
  postBtn.disabled=true;

  username.oninput=()=>{
    postBtn.disabled=username.value.trim()==="";
  };
}

// ---------------- POST ----------------

window.post=function(){

  let text=msg.value.trim();
  let name=username.value.trim();

  // admin reset
  if(name==="/reset"){
    db.remove();
    timerRef.set(Date.now()+TIMER_DURATION*1000);
    msg.value="";
    return;
  }

  if(!name || !text) return;

  let now=Date.now();

  if(now-lastPostTime<SPAM_COOLDOWN){
    alert("Slow down!");
    return;
  }

  lastPostTime=now;

  if(containsBannedWord(text)){
    alert("Blocked message.");
    return;
  }

  db.push({
    name,
    message:text,
    color:selectedColor,
    time:now
  });

  timerRef.set(now+TIMER_DURATION*1000);

  msg.value="";
};

// ---------------- COMMENTS ----------------

db.on("value", snap=>{

  if(!comments) return;

  comments.innerHTML="";

  snap.forEach(c=>{
    let d=c.val();

    comments.innerHTML+=`
      <div class="comment">
        <span style="color:${d.color};font-weight:bold;">
          ${escapeHTML(d.name)}
        </span>: ${escapeHTML(d.message)}
      </div>`;
  });

});

// ---------------- SECURITY ----------------

function escapeHTML(str){
  return str.replace(/[&<>"']/g,m=>({
    "&":"&amp;",
    "<":"&lt;",
    ">":"&gt;",
    '"':"&quot;",
    "'":"&#039;"
  }[m]));
}

// ---------------- RICKROLL ----------------

window.rickroll=function(){
  document.getElementById("rickroll").style.display="block";
  document.getElementById("rickAudio").play();
};

window.closeRickroll=function(){
  let r=document.getElementById("rickroll");
  let a=document.getElementById("rickAudio");
  r.style.display="none";
  a.pause();
  a.currentTime=0;
};

});

</script>

</body>
</html>
