<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improved Chat Application</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; }
        #chat { border: 1px solid #ccc; padding: 10px; overflow-y: auto; height: 300px; background-color: white; }
        .dark-mode { background-color: #333; color: #fff; }
        button { margin: 5px; }
    </style>
</head>
<body>
    <div id="chat"></div>
    <input type="text" id="message" placeholder="Type your message..." />
    <button id="send">Send</button>
    <button id="dark-mode-toggle">Toggle Dark Mode</button>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyA6-aUnsjspvJ_cytAfGDYWRnF7ydc0wHk",
            authDomain: "site-976a4.firebaseapp.com",
            databaseURL: "https://site-976a4-default-rtdb.firebaseio.com",
            projectId: "site-976a4",
            storageBucket: "site-976a4.firebasestorage.app",
            messagingSenderId: "580869997154",
            appId: "1:580869997154:web:ed3ed829cdbb6b2101c73b",
            measurementId: "G-K2N9HMFFZY"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        // Timer persistence with localStorage
        var timer = localStorage.getItem('timer') || 0;
        var timerElement = document.createElement('div');
        timerElement.innerText = 'Timer: ' + timer + ' seconds';
        document.body.appendChild(timerElement);
        setInterval(() => {
            timer++;
            localStorage.setItem('timer', timer);
            timerElement.innerText = 'Timer: ' + timer + ' seconds';
        }, 1000);

        // Send message
        document.getElementById('send').onclick = function() {
            var message = document.getElementById('message').value;
            if (message.trim() === '') return; // Prevent empty messages
            database.ref('messages/').push({
                text: message,
                timestamp: Date.now()
            });
            document.getElementById('message').value = '';
        };

        // Display messages
        database.ref('messages/').on('child_added', function(snapshot) {
            var message = snapshot.val().text;
            var div = document.createElement('div');
            div.innerText = message;
            document.getElementById('chat').appendChild(div);
        });

        // Dark mode toggle
        document.getElementById('dark-mode-toggle').onclick = function() {
            document.body.classList.toggle('dark-mode');
        };

        // Rate limiting: Allow sending one message every 5 seconds
        let canSend = true;
        document.getElementById('send').onclick = function() {
            if (!canSend) return;
            canSend = false;
            setTimeout(() => canSend = true, 5000);
            // Sending message logic...
        };
    </script>
</body>
</html>